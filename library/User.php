<?php

class User extends \FW\User\User {

    use \traits\BadIp;

    static $avatar = '';
    static $age = '';
    static $email = '';
    static $lastactive;
    static $facebook_id;
    static $datas = ['id','role','login','avatar', 'age', 'email', 'lastactive', 'facebook_id'];
    static $captcha = 0;

    static function Start($auth = [])
    {
        if (in_array($_SERVER['REMOTE_ADDR'], self::$badip)) {
            header("HTTP/1.0 503 Service Unavailable");
            require './skins/stubroutine.tpl';
            exit;
        }

        parent::Start($auth); // TODO: Change the autogenerated stub
        if (empty(self::$role)) {
           self::$captcha = 1;
        } elseif (self::$role == 'ban') {
            \FW\User\Authorization::logout();
            redirect('/');
        } elseif (self::$role == 'admin' && isset($_GET['route']) && preg_match('#^admin(/.*|)$#ui', $_GET['route'])) {
            $method = (!empty($_POST)) ? 'POST' : 'GET';
            q("
                INSERT INTO `monitor_admin` SET
                `admin_id` = ".(int)self::$id.",
                `url` = '".Core::$DOMAIN.$_SERVER['REDIRECT_URL']."',
                `date` = NOW(),
                `method` = '".$method."'
            ");
        }
    }
}